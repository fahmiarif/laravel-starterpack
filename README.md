# E-Billing

A modern, full-stack billing management system built with **Laravel 12**, **React 19**, and **Inertia.js**. Features a dynamic role-based admin panel with drag-and-drop menu management, user administration, and a polished ShadCN UI.

---

## âœ¨ Features

### Admin Panel
- **User Management** â€” Full CRUD with role assignment, impersonation, and soft deletes.
- **Role & Permission Management** â€” Powered by [Spatie Laravel Permission](https://spatie.be/docs/laravel-permission) with grouped permission UI.
- **Dynamic Menu Management** â€” Drag-and-drop sortable sidebar menus with hierarchical nesting and role-based visibility.

### Developer Experience
- **Type-Safe Frontend** â€” Strict TypeScript with Zod schema validation and `react-hook-form`.
- **Server State** â€” `@tanstack/react-query` for all data fetching, caching, and mutations.
- **Auto-Generated Routes** â€” [Laravel Wayfinder](https://github.com/laravel/wayfinder) eliminates hardcoded URLs.
- **Code Quality** â€” ESLint, Prettier, Laravel Pint, and Pest testing pre-configured.

---

## ğŸ› ï¸ Tech Stack

| Layer      | Technology                                                                 |
|------------|-----------------------------------------------------------------------------|
| Backend    | PHP 8.2+, Laravel 12, Fortify (Auth), Spatie Permissions                    |
| Frontend   | React 19, TypeScript 5, Inertia.js 2, Tailwind CSS 4, ShadCN UI (Radix)    |
| State      | TanStack React Query 5, React Hook Form 7, Zod 4                           |
| Build      | Vite 7, React Compiler (Babel Plugin)                                       |
| Database   | PostgreSQL (Supabase) / SQLite (local)                                      |
| DnD        | @dnd-kit (core, sortable, utilities)                                        |

---

## ğŸ“‹ Prerequisites

- **PHP** >= 8.2
- **Composer** >= 2.x
- **Node.js** >= 20.x
- **npm** >= 10.x
- **PostgreSQL** 15+ (or SQLite for local dev)

---

## ğŸš€ Getting Started

### 1. Clone the Repository

```bash
git clone https://github.com/your-org/ebilling.git
cd ebilling
```

### 2. Install Dependencies

```bash
composer install
npm install
```

### 3. Environment Setup

```bash
cp .env.example .env
php artisan key:generate
```

Edit `.env` to configure your database:

```dotenv
# SQLite (default for local dev)
DB_CONNECTION=sqlite

# PostgreSQL (production / Supabase)
DB_CONNECTION=pgsql
DB_HOST=your-host.supabase.co
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=your-password
```

> **Note:** If using Supabase's Transaction Pooler (port 6543), add `DB_PGSQL_OPTIONS="--options=prepare_threshold=0"` or disable prepared statements in `config/database.php`.

### 4. Run Migrations & Seeders

```bash
php artisan migrate
php artisan db:seed --class=RoleAndPermissionSeeder
php artisan db:seed --class=MenuSeeder
php artisan db:seed                                  # Creates test user
```

This will create:
- **Roles**: `superadmin`, `admin`, `staff`
- **Permissions**: `view users`, `create users`, `edit users`, `delete users`, `manage roles`
- **Default Menus**: Dashboard, User Management, Role Management, Menu Management

### 5. Start Development Server

```bash
composer run dev
```

This concurrently starts:
- **Laravel Server** at `http://localhost:8000`
- **Queue Worker**
- **Vite Dev Server** (HMR)

---

## ğŸ“ Project Structure

```
ebilling/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Enums/                  # UserRole enum
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/Admin/  # UserController, RoleController, MenuController
â”‚   â”‚   â”œâ”€â”€ Requests/Admin/     # FormRequest validation classes
â”‚   â”‚   â””â”€â”€ Resources/Admin/    # Eloquent API Resources
â”‚   â”œâ”€â”€ Models/                 # User, Menu (UUIDs, SoftDeletes)
â”‚   â””â”€â”€ Services/Admin/         # Business logic (UserService, MenuService, etc.)
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/             # Users, permissions, menus, menu_role
â”‚   â””â”€â”€ seeders/                # RoleAndPermissionSeeder, MenuSeeder
â”œâ”€â”€ resources/js/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ admin/              # MenuFormDialog, RoleFormDialog, UserFormDialog
â”‚   â”‚   â””â”€â”€ ui/                 # ShadCN components (Button, Card, Dialog, etc.)
â”‚   â”œâ”€â”€ hooks/admin/            # React Query hooks (user-hooks, menu-hooks, etc.)
â”‚   â”œâ”€â”€ layouts/                # AppLayout, AdminLayout
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ admin/              # Users, Roles, Menus management pages
â”‚   â”‚   â”œâ”€â”€ auth/               # Login, Register, etc.
â”‚   â”‚   â””â”€â”€ settings/           # Profile & password settings
â”‚   â”œâ”€â”€ routes/                 # Auto-generated by Wayfinder
â”‚   â””â”€â”€ types/admin/            # TypeScript interfaces & Zod schemas
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ web.php                 # Main application routes
â”‚   â””â”€â”€ settings.php            # Settings routes
â””â”€â”€ vite.config.ts              # Vite + React + Tailwind + Wayfinder
```

---

## ğŸ” Authentication & Authorization

### Authentication
Powered by **Laravel Fortify** with support for:
- Login / Registration
- Email Verification
- Password Reset
- Two-Factor Authentication (2FA)

### Authorization
Uses **Spatie Laravel Permission** with three default roles:

| Role         | Permissions                                              |
|--------------|----------------------------------------------------------|
| `superadmin` | All permissions                                          |
| `admin`      | `view users`, `create users`, `edit users`, `manage roles` |
| `staff`      | `view users`                                             |

---

## ğŸ—‚ï¸ API Routes

All admin routes are prefixed with `/admin` and require authentication.

| Method   | URI                     | Action                  | Name               |
|----------|-------------------------|-------------------------|---------------------|
| `GET`    | `/admin/users`          | User listing            | `admin.users.index`   |
| `POST`   | `/admin/users`          | Create user             | `admin.users.store`   |
| `PUT`    | `/admin/users/{user}`   | Update user             | `admin.users.update`  |
| `DELETE` | `/admin/users/{user}`   | Delete user             | `admin.users.destroy` |
| `GET`    | `/admin/roles`          | Role listing            | `admin.roles.index`   |
| `POST`   | `/admin/roles`          | Create role             | `admin.roles.store`   |
| `PUT`    | `/admin/roles/{role}`   | Update role             | `admin.roles.update`  |
| `DELETE` | `/admin/roles/{role}`   | Delete role             | `admin.roles.destroy` |
| `GET`    | `/admin/menus`          | Menu tree               | `admin.menus.index`   |
| `POST`   | `/admin/menus`          | Create menu             | `admin.menus.store`   |
| `PUT`    | `/admin/menus/{menu}`   | Update menu             | `admin.menus.update`  |
| `DELETE` | `/admin/menus/{menu}`   | Delete menu             | `admin.menus.destroy` |
| `PATCH`  | `/admin/menus/reorder`  | Reorder menus           | `admin.menus.reorder` |
| `GET`    | `/admin/menus/sidebar`  | Get sidebar for user    | `admin.menus.sidebar` |

---

## ğŸ§ª Testing & Quality

### Run Tests

```bash
# Full test suite (lint + tests)
composer test

# PHP tests only
php artisan test

# PHP linting
composer lint
```

### Frontend Quality

```bash
# TypeScript type check
npm run types

# ESLint
npm run lint

# Prettier formatting
npm run format

# Check formatting
npm run format:check
```

---

## ğŸ—ï¸ Build for Production

```bash
# Standard build
npm run build

# With SSR support
npm run build:ssr
```

### Run with SSR

```bash
composer run dev:ssr
```

---

## ğŸ“ Development Conventions

For detailed coding standards, see [`CODE-GUIDE.md`](./CODE-GUIDE.md). Key highlights:

- **Backend**: Request-Service pattern, Eloquent Resources, `DB::transaction` for multi-table ops.
- **Frontend**: PascalCase directories for pages/components, `@/` path alias, no `any` types.
- **Forms**: `react-hook-form` + `zod` resolver with centralized schemas in `types/admin/`.
- **State**: React Query for server state, Inertia `usePage().props` only for global data.
- **Routing**: Always use Wayfinder â€” never hardcode URLs.
- **UI**: ShadCN components, `sonner` for toasts, `ConfirmDialog` for confirmations.

---

## ğŸ“„ License

This project is licensed under the [MIT License](https://opensource.org/licenses/MIT).
